<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zrt.sec.mapper.handle.HandlerMapper">

	<!-- 查询职务 -->
	<select id="searchPosition" resultType="java.util.HashMap">
		SELECT p_s_p_id,p_name 
		FROM sys_plat_position
		WHERE 1 = 1
		<if test="p_s_p_id != null and p_s_p_id != ''">
			and p_s_p_id = #{p_s_p_id}
		</if>
	</select>


	<!-- 模糊查询职务 -->
	<select id="commonSearchPositionTree" resultType="java.util.HashMap">
		SELECT
		sso1.parent_org_id AS parent_id,
		sso1.org_id AS p_s_p_id,
		sso1.org_name AS p_name,
		'0' AS type
		FROM
		(
		SELECT
		o.org_id,
		o.parent_org_id,
		o.org_name,
		o.group_type
		FROM
		sys_sec_org o
		WHERE
		o.org_id LIKE '00010001%'
		AND o.sec_enabled = '1'
		) sso1
		WHERE
		sso1.group_type = '1'
		UNION ALL
		SELECT
		DISTINCT
		a.org_id parent_id,
		a.emp_position_id p_s_p_id,
		c.p_name,
		'1' AS type
		FROM
		sys_sec_emp_position a
		LEFT JOIN sys_sec_org b ON a.org_id = b.org_id
		LEFT JOIN sys_plat_position c ON a.emp_position_id = c.p_s_p_id
		LEFT JOIN sys_plat_rank d ON a.r_id = d.r_id
	</select>
	
	
	<!-- 模糊查询职务 -->
	<select id="commonSearchPosition" resultType="java.util.HashMap">
		SELECT
		DISTINCT
		a.org_id parent_id,
		a.emp_position_id p_s_p_id,
		c.p_name,
		'1' AS type
		FROM
		sys_sec_emp_position a
		LEFT JOIN sys_sec_org b ON a.org_id = b.org_id
		LEFT JOIN sys_plat_position c ON a.emp_position_id = c.p_s_p_id
		LEFT JOIN sys_plat_rank d ON a.r_id = d.r_id
		<where>
			<choose>
				<when test="mapParam.searchArr != null ">
					<foreach collection="mapParam.searchArr" item="search1"
						open="(" close=")">
						( a.org_name LIKE CONCAT('%',#{search1},'%')
						or
						d.r_name LIKE CONCAT('%',#{search1},'%')
						or c.p_name LIKE
						CONCAT('%',#{search1},'%'))
					</foreach>
				</when>
			</choose>
		</where>
			limit 0,8
	</select>



	<!-- 查询部门 -->
	<select id="searchOrg" resultType="java.util.HashMap">
		SELECT MAX(org_id) max FROM sys_sec_org WHERE parent_org_id = #{parent_org_id}
		<!-- SELECT
		org_id parent_org_id,
		org_name parent_org_name ,
		manage_emp_id
		parent_manage_emp_id ,
		manage_emp_name parent_manage_emp_name ,
		charge_emp_id parent_charge_emp_id ,
		charge_emp_name
		parent_charge_emp_name ,
		org_code parent_org_code ,
		org_code_view
		parent_name_view ,
		org_name_view parent_name_view ,
		org_name_owner
		parent_name_owner ,
		org_name_all parent_name_all
		FROM
		sys_sec_org
		WHERE 1 = 1
		<if test="parent_org_name != null and parent_org_name != ''">
			org_name LIKE ('%',#{parent_org_name},'%')
		</if> -->
	</select>



	<!-- 模糊查询 -->
	<select id="commonSearchOrg" resultType="java.util.HashMap">
		SELECT
		sec_order emp_order,
		org_id id,
		org_id ,
		parent_org_id parent_id ,
		org_name ,
		org_name_view show_name ,
		manage_emp_name emp_name ,
		manage_emp_id
		emp_id ,
		org_code emp_code
		FROM
		sys_sec_org
		<where>
			<choose>
				<when test="mapParam.searchArr != null ">
					<foreach collection="mapParam.searchArr" item="search1"
						open="(" close=")">
						org_name LIKE CONCAT('%',#{search1},'%')
					</foreach>
				</when>
			</choose>
			<if test="mapParam.page == null or mapParam.page == ''">
				limit 0,8
			</if>
		</where>

	</select>


	<!-- 通用的精确部门检索 -->
	<select id="orgTrueSearch" resultType="java.util.HashMap">
		SELECT
		sec_order emp_order,
		org_id id,
		org_id ,
		parent_org_id parent_id ,
		org_name ,
		org_name
		show_name ,
		manage_emp_name emp_name ,
		manage_emp_id emp_id ,
		org_code
		emp_code
		FROM
		sys_sec_org
		WHERE
		org_id = #{org_id}
	</select>
	
	
	<!--查询员工工号是否重复 -->
	<select id="searchEmpId" resultType="int">
		SELECT COUNT(emp_id) FROM sys_sec_emp WHERE emp_id	 = #{emp_code} ;
	</select>

</mapper>